<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>convert</title>
		<style type="text/css" media="screen">
		textarea {
			width: 100%;
			height: 250px;
		}
		</style>
	</head>
	<body>

		<h3>Enter your HTML</h3>
		<textarea name="input"></textarea>
		<p><input type="button" value="Submit" id="inputSubmit"></p>

		<hr>

		<h3>Output DOMBuilder code (assumes <code>DOMBuilder</code> has been aliased to <code>_</code>)</h3>
		<textarea name="output" readonly="readonly"></textarea>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
		$(function() {

			$('input#inputSubmit').click(function(evt) {
				var input = $('textarea:first').val().replace(/>\s+</gm, '><');
				var db = convertToDOMBuilder(input);
				$('textarea:last').val(db);
			});

			window.convertToDOMBuilder = function(html) {
				var text = [],
					output,
					container = (function(html) {
						var d = document.createElement('div');
						d.innerHTML = html;
						return d;
					})(html),
					nodes = container.childNodes,
					indent = 1;

				for (var i = 0, max = nodes.length; i < max; i++) {

					var tagName = nodes[i].nodeName.toLowerCase();

					if (tagName === '#text') {
						text.push("document.createTextNode('" + nodes[i].data + "')");
					}
					else {
						if (nodes[i].attributes.length) {
							var attr = [];
							for (var j = 0, jmax = nodes[i].attributes.length; j < jmax; j++) {
								attr.push("'" + nodes[i].attributes[j].nodeName + "':'" + nodes[i].attributes[j].nodeValue + "'");
							}
							text.push("_('" + tagName + "', { " + attr.join(', ') + " })" + parseChildren(nodes[i].childNodes, indent + 1));
						}
						else {
							text.push("_('" + tagName + "')" + parseChildren(nodes[i].childNodes, indent + 1));
						}
					}
				}

				return "_.DOM([\n" + ind(indent) + text.join(",\n" + ind(indent)) + "\n])"
			};

			var ind = function(max) {
				var t = "";
				for (var i = 0; i < max; i++) {
					t += "\t";
				}
				return t;
			};

			var parseChildren = function(nodes, indent) {
				var text = [], ends = ['', ''];

				if (nodes[0].nodeName.toLowerCase() === '#text') {
					text.push(".html('" + nodes[0].parentNode.innerHTML + "')");
				}
				else {
					for (var i = 0, max = nodes.length; i < max; i++) {

						var tagName = nodes[i].nodeName.toLowerCase();

						if (tagName === '#text') {
							text.push(".html('" + nodes[i].data + "')");
						}
						else {
							if (nodes.length === 1) {
								ends[0] = '.child(\n' + ind(indent);
							}
							else if (nodes.length > 1) {
								ends[0] = '.child([\n' + ind(indent);
							}

							indent++;

							if (nodes[i].attributes.length) {
								var attr = [];
								for (var j = 0, jmax = nodes[i].attributes.length; j < jmax; j++) {
									attr.push("'" + nodes[i].attributes[j].nodeName + "':'" + nodes[i].attributes[j].nodeValue + "'");
								}
								text.push("_('" + tagName + "', { " + attr.join(', ') + " })" + parseChildren(nodes[i].childNodes, indent));
							}
							else {
								text.push("_('" + tagName + "')" + parseChildren(nodes[i].childNodes, indent));
							}

							indent--;

							if (nodes.length === 1) {
								ends[1] = "\n" + ind(indent - 1) + ')';
							}
							else if (nodes.length > 1) {
								ends[1] = "\n" + ind(indent - 1) + '])';
							}
						}
					}
				}

				return ends[0] + text.join(",\n" + ind(indent)) + ends[1];
			};
		});
		</script>
	</body>
</html>